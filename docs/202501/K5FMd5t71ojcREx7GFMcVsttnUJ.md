# 喂饭级教程!教你用coze做一个微信小程序之二：如何绑定工作流到页面

> 来源：[https://b121w2zgwyx.feishu.cn/docx/K5FMd5t71ojcREx7GFMcVsttnUJ](https://b121w2zgwyx.feishu.cn/docx/K5FMd5t71ojcREx7GFMcVsttnUJ)

太好用了，即使不懂代码，通过简单的拖拽，也能轻松构建自己想要的AI应用，从此小程序自由了。

上一篇内容，带大家，简单的搭建了个 海报生成的小程序页面，没看过的，请跳转

只有页面，肯定还算不上程序，还需要实现一下真正的功能。

因此，今天的目标是，把首页的 一键生成海报 业务逻辑实现，come on！

# 一、分析海报生成功能

我们先来看一下，上一篇我们设计的海报生成功能页面：

![](img/dbacd83c6073ca351fabb0b2cb273f35.png)

从这张图分析，得出我们总共需要以下几个输入项:

1、节气名称

2、图像要求

3、风格（便于后期扩展各种风格，教程只做一种）

由于我们后续还有个历史生成记录的显示，所以我们最终需要的输出内容为：

1、一张海报图片

2、节气名称

3、生成时间

为了便于大家对于工作流的理解，我先展示一下我海报的效果图：

![](img/f261933d3a43dd2c8ec709077fd99186.png)

根据效果图，我将设计工作流的工作流程如下：

1、根据节气名称和图像要求，生成图像提示词

2、根据节气名称，生成一段诗词文案

3、将节气名称和诗词放到背景图上

这是一个比较简单的功能，没有特别复杂的地方，接下来我们开始搭建。

# 二、开始搭建工作流

因为我们主要是为了讲应用的搭建，像海报的排版问题我将略过，只讲工作流与页面交互比较重要的部分。

## 1、添加工作流

![](img/78da474d5fd3595f158e1c9bc221a343.png)

如果选择“新建工作流”那么这个工作流就会只在这个应用里可用。

也可以选择“引入资源库文件”，这个意思就是，如果你之前有开发过工作流，发现可以用的上，就可以直接引入使用，就不用重复开发了。

这里，我们选择“新建工作流”。新建了一个叫做 haibao_make的工作流

## 2、配置输入输出

在开始节点配置一下输入项

![](img/bd97fe3150cd9fc121ca80f9b981599b.png)

在结束节点配置输出项

![](img/7448c631a49407bbf2f9ada0609fcc3b.png)

## 3、根据节气名称和要求生成文案和图像提示词

添加一个大模型节点 ，用来一键生成文案，以及用于生成图像的提示词

大模型配置如下：

输入项，将开始节点的节气名称，和图像要求传入

![](img/eb269476006f19b7d733522f0cbc89e8.png)

输出项输出文案内容和 图像提示词；

![](img/2def0870d7dbd6c7287e7a5a29c4e416.png)

大模型的提示词我简单写了一下，现在coze可以让ai优化提示词，如果有不满意的可以结合ai优化，很方便，以下是我的系统提示词，给大家做参考：

```
# 角色
你是一位极具天赋的 24 节气海报创作大师，对中国传统的 24 节气文化有着深刻的认知和独特的感悟。能够依据用户给出的节气名称，创作出一首意境优美的七言绝句来生动展现该节气，同时精准生成适合用于 AI 生成图片的提示词。最终以 JSON 格式呈现，如{"content":"七言绝句内容","prompt":"图片提示词内容","backprompt":"背景图片提示词内容"}。

## 技能
### 技能 1：创作节气七言绝句
1\. 接收用户给出的节气名称后，深入剖析该节气的特色要素，涵盖自然景观、气候特点、传统习俗等，以此为灵感创作一首七言绝句。
2\. 绝句语言优美生动，富有感染力，能让读者通过诗句直观感受节气魅力。
3\. 每两句换行，无需标题。

### 技能 2：生成背景图片提示词
1\. 根据节气特征，提炼出关键视觉元素，生成不超过四个的简洁图片提示词，且不能包含与“白色”相关的描述。
2\. 提示词要具有针对性和引导性，能帮助 AI 生成画面干净、主题突出、细节丰富的符合节气主题的精美图片。
## 限制：
- 仅专注于 24 节气相关内容进行创作和回答，绝不涉及与 24 节气无关的话题。
- 严格按照规定的 JSON 格式输出结果，不得有任何偏差。
- 生成的图片提示词需要主题清晰，适合 AI 作图，避免使用一些形容词。
```

## 4、图像生成

由于我准备使用的第三方flux的图像生成，但我们习惯性输入中文提示词，因此我这边还要先将提示词优化一下。

添加一个插件，查找如下的提示词优化插件添加进来，这个插件会根据你的提示词做翻译，并且还会自己添加一些优化提示词。最终输出一段英文提示词。

![](img/f23fa262cd8e07bae1e6e0fa2b3e3fac.png)

接下来添加一个flux生成图片的插件

![](img/b378d9baaa0ef4aac27bc6a15860dddf.png)

按照下面设置一下输入参数：

![](img/d5d7f2fcbd5e66751b34cd838329ff3c.png)

## 5、海报合成

这里我用到了自己搭的一个图像合成工作流，篇幅有限不做过多介绍，这个工作流很简单，就是用画板将文字和图片合在一起，这个工作流我简单截图一下

![](img/bf49ccaa98ea45639c4694d3da27240c.png)

然后我们把这个工作流添加进来，按照如下将输入配置一下

![](img/9fa97abe61b886b5ffdf6159da53afa9.png)

## 6、连接输出，调试

在配置结束节点的时候，我们发现还有一个"生成时间"我们没有获取，其实是可以在生成文案的大模型那里加个时间的，不过现在我懒得改了，直接添加一个代码块 来解决吧。

![](img/0b740a7d07858298465a753df2b8b523.png)

详细的python代码如下，你们拷贝进去，参照上图一样配置一下输出项就可以了：

```
from datetime import datetime
async def main(args: Args) -> Output:
    params = args.params
    # 获取当前时间
    now = datetime.now()

    # 格式化时间
    formatted_now = now.strftime("%Y-%m-%d %H:%M:%S")
    # 构建输出对象
    ret: Output = {
        "datetime": formatted_now
    }
    return ret
```

最后把结束节点的输出调整一下：

![](img/7973083a640a8032b7afa0a034e7be3d.png)

点击试运行调试一下，没问题就可以进行下一步了。

# 三、页面与工作流的逻辑交互

终于到最重要的一步了，将我们的页面和工作流逻辑绑定起来实现完整功能。

## 1、设置表单提交事件

我们需要将表单数据跟工作流绑定，所以我们要设置一下表单的事件，先选中表单

![](img/b2d5f64d39451f72e5ea2185786cd578.png)

接下来按以下步骤操作

![](img/dba56de09b5f67fc6e42a6761443156a.png)

## 2、绑定工作流

前面的步骤，选中工作流之后会弹出新的页面：

![](img/c2410c93e46f7090f570e9ad8d4881b5.png)

我们将workflow 切换成我们之前搭建好的工作流，然后就会出现工作流的输入项，这里我们需要将页面的数据绑定进来。

怎么绑定呢？

首先我们需要先确定一下我们每个输入内容对应的，还是切换到结构页面，我们依次点击一下表单里的元素，然后我们观察一下，我们所需要的内容对应的结构里的名称是什么，举个例子，如下图：

![](img/2a4442fd29418f525aca810acd41f3e4.png)

当我点击到 结构里的 “input1”的时候，发现它对应的就是我们的节气名称输入框，我们把 这个input1 记住了。

然后，我们回到表单绑定工作流页面，找到右边的这个按钮点击

![](img/1a0d815e8dcc10409bc3f3fb89d3c931.png)

接着，在弹出的框框中找到 input1 点击选中

![](img/33dd724fa62a16aeb21fb5da1045eda9.png)

然后 另外两个参数，一样的操作，最后点击确认 ，至此表单的绑定就成功了。

![](img/8f0e3aa94d84a78b65a26f62450ef0db.png)

## 3、绑定生成按钮事件

正常情况下我们加进来的按钮会自动绑定“提交表单的事件”，但为了确保没有问题，我们还是再检查一下好了，点击生成按钮，点击事件确保配置如下：

![](img/c712e320a5abec6ed2b2cc04f11e0f19.png)

## 4、绑定输出的图片

生成做好之后，我们还需要将生成后的数据展现在下方

我们点击图片，然后按下图将工作流的输出参数里的图片绑定到 图片控件上

![](img/6d12d5a0f240ce63c21fdd5c0be0b256.png)

再做个小优化，当刚进入页面没有任何生成的时候，我们将图片设置为隐藏，然后在点击生成的时候才显示出来

选中图片，将图片默认隐藏状态改为 true

![](img/2174b41101fff2624d2a6c359818e5f8.png)

然后在点击生成的时候加一个事件，将图片控件显示出来，看如下配置：

![](img/5c3ddd8b58221659b74fb64d10e9d46e.png)

# 四、预览测试

额。。。生成了个小可爱，如果想要图片更好看，还需要在提示词上做优化。

![](img/82b1a1b594acd266f4bfa292b776bd8d.png)

到这里首页的逻辑就实现了。下一节我们将上一点难度，实现“我的”页面里查看历史生成记录。