<h1>ClaudeCode+n8n，双剑合璧重塑小红书为像素红薯-s</h1>
<blockquote>来源：<a href="https://sqm685cmohb.feishu.cn/docx/Ltiydw43JoFUyoxqfvycjWOvn17">https://sqm685cmohb.feishu.cn/docx/Ltiydw43JoFUyoxqfvycjWOvn17</a></blockquote>
<p>大家好，我是志辉，10 年大数据架构，现专注 AI 编程。</p>
<p>我想在这条路上带领更多人实现自己的创意</p>
<p>也希望可以碰撞出更多的火花，带来未来无限的空间</p>
<p>这段时间一直在研究 claude code，我的工作项目、副业项目都和 claude code 分不开了。</p>
<p>使用 claude code 做了很多垃圾，也有些项目跑起来了。也在和大家积极探索 AI 编程的最佳范式。</p>

<p>智能体很火爆，之前我配置过一个推特采集然后写文章的过程，太痛苦。</p>
<p>那么我就想这两者能不能集合了？</p>
<p>果不其然，我尝试了下 claude code 去写 n8n 工作流。</p>
<p>结果。。。</p>
<p>我惊呆了，写的还挺准，比我人工配置的工作流好多了。</p>
<p>所以今天的这篇帖子就诞生了。</p>
<p>我相信后续 claude code 和 n8n 的结合，将产生更大的威力。</p>
<h1>先睹为快</h1>
<p>先来个视频爽快的体验下这个产品的魔力在哪里！</p>
<p>如果你想对标小红书的博主、自动发文、时刻关注博主消息等，那这个将给予你无限想象空间。</p>
<p>还有很多场景，都可以通过这个流程来实现。灵活+快速都可以做到</p>
<p>目前在这个里面可以做到什么了？</p>
<p>1、采集对标小红书博主们的所有文章以及个人信息，后续无限满足更多使用场景。</p>
<p>2、通过 n8n agent 自动工作流生成博主的报告信息，并将采集到的数据存储到数据库。</p>
<p>3、重塑小红书数据，任何形式展现操作。还可以模仿写文章和生成图片</p>
<h1>整体流程</h1>
<p><img src="img/8d70e923771ce6f67cc3c8dccf09bd01.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/SF2AbXFlloW3NhxE4Pcc6ziFnth/"/></p>
<p>其实就是三大块</p>
<p>1、小红书浏览器插件：是个爬虫采集工具，安装在浏览器上，可以自动采集博主的个人数据，包括昵称、ip 所在地、关注数、收藏/点赞数，还有每一篇文章的标题、描述、喜欢数、收藏数以及评论。</p>
<p>2、n8n agent 工作流：自动接收采集的数据，进行数据处理后，分别存储到不同的数据库表里，还会调用 AI 接口生成博主的专属报告</p>
<p>3、像素番薯系统（应用系统）：这个系统可以读取后端的数据，任意形式展现，这里我就做成像素风格了。并且可以对标生成文章，还加入了生图功能。</p>

<p>那么接下来就详细拆解下，这三个部分是如何完成的。</p>
<h1>前奏普及</h1>
<p>那还是先要普及下大家对这三个名词的认知，如果你已经知道了可以飘过直接进入下一个环节。</p>
<p>如果你还是不懂，不妨可以看看。</p>
<h2>Claude Code</h2>
<p>这个你不会还不知道吧，目前AI 编程界的扛把子，S 级的存在，至今我理解还无人能打。</p>
<p>Claude Code 已经成为我工作、生活中必不可少的编程工具。一方面是他的终端灵活，我可以在任何场景里面使用，另外一个就是我需要用很多语言和 IDE，可以很好的嵌入到的我的现有工作流里面。</p>
<p>另外就是他的 tools 的高效调用，让我对大型项目的修改也不在话下。</p>
<p>并且基于 claude 模型的文字能力，我还用于他辅助我写文章以及平时一些的工作总结报告等工作。</p>
<p>真是 Claude Code 一招工具走遍天下，打遍天下无敌手。</p>
<h2>n8n</h2>
<p>如果大家有玩智能体的都知道扣子平台了，以及dify这种可以玩开源自定义部署的工作流智能体。</p>
<p>那么 n8n 相当于他们的地方在哪里了？我的理解就是：自由度高，出海组件很丝滑。</p>
<p>比如我之前自动采集 x 的数据，然后根据我的写文风格，自动推送我需要的热点文章。</p>
<p><img src="img/2fcf1b8b982ac2de793eed75b5fa568d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/XJP6bdKx3o6HeKx73qVcfJuEnCc/"/></p>
<p>并且结合 Claude Code 的方式，上手难度降低很多。</p>
<p>靠着 Claude Code 的强大能力可以很好的完成 n8n 的工作流工作。</p>
<h2>爬虫采集</h2>
<p>这个就是老生常谈的问题了。</p>
<p>这个其实还有些敏感的话题，这里面大家还是需要严格遵守网站的 robots.txt 的内容。</p>
<p>基本爬虫就是爬取页面上的元素，就是浏览器上可以显示源码查看到的 html 代码上的，要么就是后台接口获取的元素。</p>
<p>方式就有很多了：比如使用 rpa 技术，或者使用专门的爬虫工具。</p>
<p>另外就是专业点的编程方式：使用 xpath 表达式或者 css 选择器去定位元素</p>
<p>这里我选择的就是 xpath 表达式，为什么了？因为浏览器可以直接显示元素。这样我可以快速定位到元素。</p>
<pre>//div[@class="user-name"]/text()</pre>
<p><img src="img/bf92b6f5c8d692b262ceec1b95ff484a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/MLw7bf7qQoWLVhxn2YaccOL3nSb/"/></p>
<p>当然目前 AI 技术发展太快，采用以前自动化测试框架也可以进行爬虫的工作。</p>
<p>比如使用 playwright MCP 工具，也是可以找到元素进行爬取工作的。</p>
<p>好了，说到这里，也许很枯燥，不用看懂也没关系。</p>
<p>都是写基础知识的普及，后面觉得无聊（有时间）还可以再来看的。</p>
<p>下面就进入正题，开始我的实现之路。</p>
<h1>总的工作模式</h1>
<p>先看下我的工作模式。</p>
<p>由于我要开发三个系统，所以我就直接采用终端的方式了。</p>
<p>直接在一个终端里面，开三个窗口。</p>
<p>这里很多小伙伴很好奇怎么开呀？</p>
<p>如果你是 mac 系统的话，很简单，基本所有的终端工具都支持，cmd+d：垂直分屏，cmd+shift+d：水平分屏</p>
<p>我用的终端工具：Ghostty，轻量，快捷，还不错。</p>
<p>如果你是 windows 系统的话：不太好搞，或者用 Warp 这种终端工具（我现在 mac 环境也用），不然就的多开终端窗口</p>
<p>如下图：</p>
<ul><li>左侧：就是浏览器插件开发</li></ul>
<ul><li>中间：n8n 工作流开发，没错，我的工作流是 claude code 帮我开发的，并不是我配置出来的（因为我还是小白，我只会让 ai 给我干活呀）</li></ul>
<ul><li>右侧：那就是我的像素红素系统开发了。</li></ul>
<p><img src="img/5bc1dcb8e138a628e58c265116a2249b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CG6dbL0UqoHH2zxs85Uc9cNSnkf/"/></p>
<p>三箭齐发，我一个人同时控制三位牛马工作，还是很强悍的。</p>
<p>总算自己也当上了老板、监工。</p>
<p><img src="img/62cb1c854c635e191b68998ab3279efd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/QejAbvfacoryTBxnbWqc4q7Nn1f/"/></p>
<p>这个时候不得不放这个图了，没错这就是我，哈哈哈。</p>
<p>123 已到齐，可以开始干活了。</p>
<p>结果一天的时间，用了 200+刀的费用，三位牛马给我蹬出了整个系统。</p>
<p><img src="img/517860f6375622b5c9f49811af571b66.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/UGsHbhDPqoMSZVxgCCfcZ1v2nxc/"/></p>
<p>总结：全是 claude code 开发工作，我就提需求就行</p>
<p>要求：就是对</p>
<p>说明：我的 claude code 走官方订阅，200 刀套餐。</p>
<p>其他方式我也用：拼车/镜像/API 方式。</p>
<p>成年人就是全都要，小孩子才做选择。</p>

<h1>系统盘点</h1>
<p>那你说，我看了小红书采集的系统、工具那么多。</p>
<p>你这个有啥优势呀，没搞懂。</p>
<p>1、爬虫灵活：浏览器插件目前采用 xpath 表达式（效率和反爬的均衡），后续考虑接口方式。严格加入反爬机制。只做爬虫的事情</p>
<p>2、n8n 节点：生成 AI 报告，存储爬虫数据到数据库（supabase）。</p>
<p>3、系统：灵活展现小红书数据，模仿写文，还可以生图</p>
<p>一句话就是：每个工具做他该做的事情，</p>
<ul><li>灵活性很强：后续替换其他流程也可以，比如我不想要你的像素番薯，那么完全可以 vibe 一个新的，因为的的数据早就存储好在数据库里了。</li></ul>
<ul><li>生产效率高：爬虫采集最佳 xpath 选择，效率高，直接通过 n8n 组件写入数据库，并且可以接入 AI 工具。</li></ul>
<ul><li>满足业务性需求强：这是一套完全可以定制化的系统，满足复杂的业务诉求和需求的灵活性。</li></ul>

<p>不吹牛了不吹牛了。</p>
<p>进入正题</p>
<h1>第一部分：小红书数据采集</h1>
<p>第一部分：这部分就是浏览器插件开发</p>
<p>主要工作：</p>
<p>1、小红书爬取信息的 xpath 表达式的获取</p>
<p>2、开发浏览器插件</p>
<p>3、对接 n8n 的接口</p>
<h2>步骤一：环境准备</h2>
<h3>1、浏览器模板准备</h3>
<p>开发的浏览器插件采用如下的模板代码：</p>
<p>为什么采用模板代码，避免让 claude code 自己采用格式，出现一些幻觉。</p>
<p>可以借用别人的项目工程的最佳实践。</p>
<p>地址：https://github.com/Jonghakseo/chrome-extension-boilerplate-react-vite</p>
<p>直接克隆到本地，并且重命名为 xiaohongshu-n8n-chrome-extension</p>
<pre>git clone https://github.com/Jonghakseo/chrome-extension-boilerplate-react-vite xiaohongshu-n8n-chrome-extension</pre>
<h3>2、生成第一版的项目记忆文件</h3>
<p>这其实很简单，就是claude code 的 init 命令的使用。</p>
<p>直接使用下面的提示词就可以。</p>
<pre>/init 使用中文，ultrathink</pre>
<p><img src="img/7d9806676b6b8cb89f84e5ceb1b6f040.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Se5Tb54XCog9AJx3eHQc67wonze/"/></p>
<p>等执行完成，就可以看到生成了 CLAUDE.md 文件</p>
<p><img src="img/da858a0852486d36a4c005a770881419.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FnVwbLa3vorJCVx3OjhcNSF4nXV/"/></p>
<p>也贴一下文件的内容：</p>
<p>那么这里我们为什么要生成这个记忆文件了？</p>
<p>那么就是为了后续的开发工作可以顺利进行。</p>
<p>有了 CLAUDE.md 文件后，claude code 就可以很清晰知道这个项目是什么情况？</p>

<p>比如这个项目干嘛的？是个什么的架构模式？一些代码要写在哪里？</p>
<p>还有怎么执行这个项目？怎么打包？</p>

<p>执行完后就会一清二楚了。</p>
<h2>步骤二：爬虫小技巧</h2>
<h3>1、xpath 表达式</h3>
<p>要想知道 xpath 表达式，那么就先要知道 html 的知识。</p>
<p>这里就简单说下 html 的基础知识</p>
<p>大家可以跟 ai 一起学习知识，不懂的就可以问AI。</p>
<p>我们看到的网页页面的元素，基本都是 html 决定的，比如下面的代码。</p>
<pre><h1>文章标题</h1>
<p>这是正文内容</p>
<a href="/detail/123">点击查看更多</a>
<div class="article">
  <h1>爬虫入门</h1>
  <p class="author">作者：小明</p>
  <p class="time">2025-08-21</p>
  <a href="/detail/123">阅读全文</a>
</div></pre>
<p>浏览器里面看到的是这样子的：</p>
<p><img src="img/8ad2cd4ccfa053acbd14ec675543721a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WM6Ub4uoio1LupxnJHHcqgtbnPc/"/></p>
<p>那么 xpath 是什么了？</p>
<p>XPath 是一种 路径语言，用来在 HTML 里定位节点，就像文件夹路径一样。</p>
<p>比如我要选择上面的「爬虫入门」「作者：小明」「2025-08-21」「/detail/123」怎么弄了。</p>
<p>我这里直接就揭晓答案了。</p>
<pre>标题：//div[@class="article"]/h1/text() → 爬虫入门
作者：//p[@class="author"]/text() → 作者：小明
时间：//p[@class="time"]/text() → 2025-08-21
链接：//div[@class="article"]/a/@href → /detail/123
</pre>
<p>xpath 是个技能，学起来很简单，以前爬虫的日子 xpath 表达式的语法那是滚瓜烂熟了。</p>
<p>现在好久不搞，基本忘记了，不过我有 AI，不会的基本都问 GPT 了。</p>
<p><img src="img/d6d4d9ce3acc74c4396b21ee672cf2b0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/EJSQbKFwIoevrrxth5ccez3InFg/"/></p>
<p>很简单，粘贴 html 代码，然后问某个值怎么获取，就获取到了 xpath 表达式。</p>
<h3>2、浏览器使用 xpath 表达式</h3>
<p>那么 xpath 表达式有了后，怎么知道对不对了。</p>
<p>难道去写代码才行。No ! No ! No !</p>
<p>直接浏览器调试工具打开，定位到「Elements」标签页，直接搜索 xpath 表达式就行。</p>
<p>F12 就可以打开浏览器的调试工具了。</p>
<p>下图是上面举例的演示：</p>
<p><img src="img/447c06ab7a73cad904fceaabf5cd4ee5.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FbNWbQGbKoR5UcxNefjc7bnnnDb/"/></p>
<p>这个就是实际这个项目的小红书的采集的，博主的名称的举例：</p>
<p><img src="img/0abfff89ccea2dc4a0839078acdb7792.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RvKFbT8pFowV3NxLWP4cXPsvnMe/"/></p>
<p><img src="img/a4ed9f09a95788d834e9d253e097da50.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/J2BWbncosoeRyxxUpUhcSb6Onqd/"/></p>
<p>包括美篇文章的举例：</p>
<p>以及使用 GPT 来获取这个xpath 表达式：</p>
<p>并且可以看到是有 16 个元素定位到。</p>
<p><img src="img/6b685eaec19758fe1176cadee531df94.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TuhFbiqRjonBRaxTRuscpZJen9g/"/></p>
<p><img src="img/3d85198c00b62e8cf307d7d09a5d4bf1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ReUHbHqmOoxPVRxOTVNckMoBnpd/"/></p>

<h2>步骤三：写需求文档</h2>
<p>xpath 表达式弄好后，就可以写需求文档了。</p>
<p>严格说是上面的 xpath 表达式我提前就写好了在需求文档里。</p>
<p><img src="img/36c02ec82e87bc2552c34486d337e47c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/UIRVbnzMrol16ZxwBbzcQcBynPu/"/></p>
<p>只不过我现在的需求文档需要重新整理下。以及一些功能的补充。</p>
<p>文档我也在这里贴出来吧，大家可以参考下：</p>
<p>然后 prd 的文档保存到项目目录下的 docs 目录下。</p>
<pre>docs/prd.md</pre>
<p><img src="img/8cb345301a9981b8d60a7146e0293e1b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WVwVb6PQNoOyIpxE5BmcfoWBnIe/"/></p>
<h2>步骤四：写实施文档</h2>
<p>到这里就进入开发了。</p>
<p>直接进入 claude code，然后收入如下提示词就可以了。</p>
<p>记得这里使用的是 claude code 的 plan 模式。</p>
<p>shift + tab 两次即可进入。windows 有可能要使用 alt + m 切换</p>
<pre>@docs/prd.md 这个是小红书数据采集的浏览器插件的详细需求，仔细阅读，并给出详细的规划方案，ultrathink</pre>
<p><img src="img/c4f7d3ebd6899a9b78f4591dd4f638d3.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Spsebo6OOobcQXxGxhfcpB2in7f/"/></p>
<p><img src="img/ccc8e07f5e2e97a642880f5422b006a1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/NXVBbEQjpoSjKDx5CxMcMOPknKf/"/></p>
<p>并且我把 claude code 给我的方案我保存成 markdown 文件里。</p>
<p>后面也可以进行方案的审核。</p>
<pre>保存到@docs/目录下，文件名称格式是PLAN_20250819_001.md格式。</pre>
<p><img src="img/038e4972abbcbac8b19b2946975dda21.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CXRebXjs0oTg5kxtRhYcoX4YnES/"/></p>
<p>当我看了他的详细方案后，我觉得有些可能不太够。</p>
<p>那么就继续 PLAN 模式跟claude code 对话</p>
<pre>@docs/prd.md 我后面加了“反爬虫“的要求，再重新阅读下需求和现在的方案，另外就是爬取数据的准确性上再看看，ultrathink</pre>
<p><img src="img/58de2414b57a6215ca29d9bfb9b2b08a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HdJ8bM65OoYzHtxXjQvciL8KnwC/"/></p>
<p>然后让claude code 更新文档</p>
<p>可以看到文档版本到了 2.0</p>
<p><img src="img/84b9b1c22dff2d0401b9502e354b7fe9.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/LyMVb9fAzoR0uKxe1Bocub7Unlg/"/></p>
<p>付实施文档：</p>

<h2>步骤五：牛马开干</h2>
<p>这里才到了真正开干的地方。</p>
<p>其实到这里，基本没啥可干预的。</p>
<p>如果前面的需求文档和实施文档聊的特别清楚后，这里就可以一路狂奔了。</p>
<p>我这里采用的就是狂飙模式。使用参数：--dangerously-skip-permissions</p>
<p>一路狂飙。</p>
<pre>@docs/ 根据这个目录下的文档，开始写这个项目，ultrathink</pre>
<p><img src="img/81975d37342456335590ece5c9ce663b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KcfjbFoK0oGQFNxEf2xcjvFNn1e/"/></p>
<p>这里说的还是使用plan 模式，生成计划后，就开始狂奔了。</p>
<h2>步骤六：修复问题</h2>
<p>所以狂奔的代价就来了。</p>
<p>当然这是正常的，你不狂奔，也很难保证一下子 claude code 给你写正确的。</p>

<p>问题的列举就是思路，提供大家结合问题的思路。</p>
<p>也许是个沉浸式体验我开发的过程，希望对大家有帮助。</p>
<p>开干环节可能没多少，但是这里问题的环节其实开发的重点。</p>
<p>一直在不停的跟 claude code 交互，让他解决问题。</p>
<p>比如：下面的问题</p>
<h3>问题一：爬虫关键词触发 anthropic 关键字</h3>
<p>大家仔细看红字说的，并且还有个链接，应该是触发了 Anthropic 公司的使用策略。</p>
<p>我猜测爬虫/采集这些都是不能让 ai 去干活的。</p>
<p><img src="img/0077caf94a8c694abd906fe3eb485a33.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KMTibk8ABo1et0xcZQlcFZ4cnFe/"/></p>
<p>那么解决方法很简单：你就让他换个别的方式达到你的目的，如果不好使的话，也没关系，后面多的是机会来解决这个问题。</p>
<p>所以在做这些工作的时候，尽量避免正面提爬虫/采集这些对于 Anthropic 的违禁词。</p>
<h3>问题二：无法采集数据</h3>
<pre>页面检测结果: {isValid: false, url: 'https://www.xiaohongshu.com/user/profile/68497faa0…7HFRUObas-vCl_PSLHKnTLshQwak=&amp;xsec_source=pc_feed', userId:   null, message: '请访问小红书个人主页（格式：https://www.xiaohongshu.com/user/profile/xxx）'}，页面已经检测倒是 https://www.xiaohongshu.com/user/profile/ 开头的格式，但是还是“页面不可采集“的术语，并且布局不太合理，[Image #1]</pre>
<p><img src="img/5af5d8986e2158123bc675bcb04d1bcd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CkH9bvEotoHYyoxVQKrcZUUVnHg/"/></p>
<h3>问题三：popup 布局问题</h3>
<p><img src="img/99686d320a5c005616a45a861d350944.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ZHspbXP4OokyqgxAn04cXF6znhf/"/></p>
<h3>问题四：无法弹出侧边栏的问题</h3>
<p><img src="img/7815af741db15f264a41670255916418.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ERcabNDJboNT4hxTTCKcVcBhnSd/"/></p>
<h3>问题五：信息采集不全的问题</h3>
<p><img src="img/f0d91a3bc53e10ee528250b0270ece92.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HwKZbcNVXobpSzxlQEDcZgvLnso/"/></p>
<h3>结果查看：采集到用户数据</h3>
<p><img src="img/273db148111b2724f42ce5240ba6fed7.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ANRfbd3Nko5ZIBxOXRacyTCqngH/"/></p>


<h3>问题六：采集文章数据排查</h3>
<pre>采集文章的数据，需要点击每个打开后才能采集到标题、正文这些元素的。ultrathink</pre>
<p>中间又调整了很多策略</p>
<pre>采集策略，先不滚动页面，等采集完用户数据后才开始采集文章数据，默认进来就会有一些文章，先采集已经在页面上的文章数据，需要有鼠标点击打开文章的操作，然后再采集文章的要素，比如标题、正文、评论等，ultrathink，补充信息，正常人点击的是 class="note-item" 下的class="cover" 的a标签</pre>
<p><img src="img/f7ca39a004f13054a5ecb24c94cfef9c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/NQLAbv02ooqNioxLlYCciZXXnjh/"/></p>
<h3>结果查看：最后总算看到了数据</h3>
<p><img src="img/9b643aea0f09a6b1b34a5da1609547a9.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/B5LPbyr1Qo92QLxjE81cXTUgnPe/"/></p>
<p>采集到的详细数据：</p>
<p><img src="img/91507bcde6496655e96a0c33a5d4c1f1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/VGiGb7O5Go13K6xEmFKcop32npf/"/></p>
<p>可以进行导出为 json 的数据</p>

<h2>步骤七：同步 n8n 的配置</h2>
<p>这里其实要到 n8n 的工作流配置后，才能到这个地步。</p>
<p>为了调试方便，我把前面的数据，使用了 APIFox 这个软件进行接口的调试。</p>
<p>https://apifox.com/</p>
<p>是一个 http 接口调试工具，对于小白来说可能太高深。</p>
<p>可以跟 AI 对话：http 是什么，接口是什么？我是个小白，帮我解释下，别人用APIFox 这个工具是干嘛的？</p>
<p><img src="img/95133dab3de68004684066147c0b86d9.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ICnMb0Fg3oD8uvxSnEDcTFPOnAc/"/></p>
<p>如果调试好接口后，可以拷贝代码，让 claude code 知道请求参数和响应体是什么样的。</p>
<p>避免接口参数对不上，调试麻烦。</p>
<p>当然也可以写好接口文档，因为这里只有一个接口，所以就直接粘贴到对话框提示词里面了。</p>
<pre>同步n8n接口数据的参考代码为：{粘贴刚刚复制的 APIfox 代码}</pre>
<p><img src="img/c479fe7314789d6f5c18c6c3501679ed.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KDI0bbinRothFfxju7dcnYq7nCh/"/></p>
<p>返回数据格式：</p>
<pre>{
    "success": true,
    "message": "✅ 数据保存成功",
    "errors": [],
    "details": {
        "authorSaved": true,
        "notesSaved": 114,
        "totalProcessed": 115
    },
    "timestamp": "2025-08-20T09:30:24.997Z"
}</pre>
<p><img src="img/526317053d383bf14fe4d65714a8f6f4.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Pf3vbECh7oEzdkxiDDGcHHPBnsT/"/></p>
<p>这里继续调试返回接口的数据格式：</p>
<p><img src="img/771f70fbc363356863b5fdd15f8bdac5.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ELAdbGvXXohEg0xIpYPcEqTjnVd/"/></p>
<p><img src="img/71f8483b989d8591f339bd7777e96511.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/V3Q8bRz6WogKGixzed0cNb6mn0p/"/></p>

<h2>步骤八：同步交互体验修复</h2>
<p>这里主要是对采集数据的一个同步优化的提升功能。</p>
<pre>[Image #1]，每次采集都会新增一个记录，我理解是不是只同步每次最新的那个就行，还是说每个采集的记录都可以有同步的按钮操作，深度思考下这个交互怎么好做。ultrathink</pre>
<p><img src="img/68c9ce41324ba522b08584418474674c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TA45blZWroGmLCxAylJc01zjnOc/"/></p>

<h2>步骤九：界面原型开发问题</h2>
<p>这里如下图，是个界面的布局问题。</p>
<p>其实这个问题修复了好久。搞了好几次。</p>
<p><img src="img/45ad36c5e0d48633f2e0e7073a011ee1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/U29Ob1GJJozVumxCeQucYQSenzp/"/></p>
<pre>[Image #1]，看这个布局，使用ascii复现给我画出来，我好确认你已经知道我的问题</pre>
<p>这里的有个小技巧不是布局问题，可以让 claude code 可以用 ascii 图画出来。</p>
<p>一是确认claude code 理解了你的问题。</p>
<p>二是确认 Claude code 找到了解决办法。</p>
<p><img src="img/91e29c7e03fa555a33a93f9d1ffdc07c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/QPyybU5zNocMS3xygi5c7VqcnJc/"/></p>
<p>没解决，就继续</p>
<p>加入 ultrathink</p>
<pre>实际“采集数据“，“查看已采集数据“ 两个按钮还是太长，看是否可以做成自动适应父容器的，离父容器有个padding的距离。ultrathink</pre>
<p><img src="img/a3d2c3b168b95599f00c930354ea1df1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/W4X2bOodboGLdJx6etdcTX7mn6b/"/></p>

<h2>步骤十：调试插件</h2>
<p>打开谷歌浏览器</p>
<p><img src="img/1b2552225cf750d6d17e2293f9778db8.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/L0hTbRFqqobPcFxapCcc9lwNnqd/"/></p>
<p>一定要打开开发模式</p>
<p><img src="img/cd1139690978ad0d0c02d94fe1487346.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/XKCVb09pJoXsbFxRRTPcQKa1nSb/"/></p>
<p>然后就可以看见左边的三个按钮</p>
<p><img src="img/488d76dc2ec07e13e17509f8e4b42e1b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/SeSDbBl9eotvm0xykwmcLp2Jnlg/"/></p>
<p>选择目录。</p>
<p>一般是在项目目录下的 dist 目录。</p>
<p><img src="img/5370a517e39426781df2f6aa2e5c974a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Z57gb10ChoU0vNxvEOtcGxGPncd/"/></p>
<p>浏览器插件记得置顶下，就可以看见了。</p>
<p><img src="img/0d6b2ffbd6db2eb993af23200c98c4ea.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/BZvSb3VjWoJwSIx7BcichRSsnNf/"/></p>
<p>调试的方法：</p>
<p><img src="img/f00aeb3f7b09f3e55d0b44aee266fa7e.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/EKESbXh5JoGdzoxdeCmc4HvGnbd/"/></p>
<p>如果要调试网络请求，可以切到 network 界面</p>
<p><img src="img/e45a60066cd5f6b52f92d1b481ec1515.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/L8n8bxdfgoGUUux6GBic9ajonRg/"/></p>
<h2>最后的总结</h2>
<p>到这里基本就完成了浏览器的工作开发</p>
<p>其实有很多确实要有一些基础知识，比如 xpath 表达式，还有 http 接口，F12调试窗口。</p>
<p>还有一种方法，你搞不定，你可以找个搞得定的人来帮你搞定。</p>

<h1>第二部分：n8n agent 开发</h1>
<p>到这里就更精彩了，可以说是全文的精华部分，也是最精彩的部分。</p>
<p>建议你倒好茶后，慢慢细品。</p>
<p>这里主要就是下面几个点</p>
<p>1、n8n 的工作都是 claude code 开发，我没有配置一个</p>
<p>2、接入 AI，生成个性化的博主的报告</p>
<p>3、数据都存储在数据库中（supabase）</p>
<h2>步骤一：准备建表的工作</h2>
<p>因为数据要存储，所以需要建表工作。</p>
<p>这里可能又要难道小白了，因为涉及后端数据库的概念，还有表的语法。</p>
<p>不懂记得问 AI，如今时代学习能力我觉得是最需要的能力。</p>
<h3>1、建表需求</h3>
<p>提示词如下：</p>
<p><img src="img/8e8a97861eb054884026ac1dabcdac57.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TDdGbRcbwoFtEfxeyPscQ8hDnNY/"/></p>
<p>主要就是把 json 的数据结构，文章的和博主的都需要粘贴到提示词里。</p>
<p>这样 claude code 可以很精准的推断出需要的表的建表语句。</p>
<pre>{这里粘贴 json 的数据格式数据}

上面的数据是小红书的笔记和作者的数据，我希望有2个 supabase 的表来存储，分别是作者列表，以及笔记列表。

其他要求如下：
- 笔记列表就是保存对应的笔记数据，同时需要有一个作者id的字段能够联系起来。
- 作者表需要额外添加一个 report 字段
- 表不需要外键约束
- 暂时不需要 RLS 策略

请你给到我在supabase中创建这两个表的SQL语句，保存到 @supabase.sql 文件中</pre>
<h3>2、创建需要存储数据的表（supabase）</h3>
<p>这里就是让 claude code 创建 sql 的建表语句。</p>
<pre>@prd_ddl.md 根据文件中的描述，生成所需要的sql内容</pre>
<p><img src="img/497efa6399c7b5a9eb023eccfb9b28cd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/LEZnbeVJuoo7XExXeP4cmVZrnVc/"/></p>
<p>创建了 sql 文件</p>
<p><img src="img/f144744b1ddd95402d15f06b12b31caa.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Ie95bJRSMoj5wCx3m2jcNUw8nNh/"/></p>
<p>supabase 执行 sql</p>
<p><img src="img/afacbc4bb27ce2a8ea981dbb3bda0979.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Y55bbRWUYoPIcpx00qFcpXHlnxh/"/></p>
<p>这里有 supabase 的概念。</p>
<p>可以说就是云数据库，很方便集成了很多功能。</p>
<p>现在基本建站都会基于 supabase 来弄。</p>
<p>supabase 也是本地整个系统最要的组件之一。</p>
<p>相当于电脑的硬盘，存储着从小红书采集的数据。</p>
<p>后续我们的系统也会从这里读取数据。</p>
<p>所以是屯粮基地，不容许有失。</p>
<p>supabase 的使用很简单，注册完后。</p>
<p>创建一个项目就可以用了。</p>
<h2>步骤二：n8n 工作流 json 配开发</h2>
<p>！！！重点！！！重点！！！重点！！！</p>
<p>它来了，它来了。</p>
<p>这里就是使用 claude code 开发 n8n 工作流的重点。两种方式</p>
<p>方式一：直接生成 n8n 的 json 配置文件</p>
<p>方式二：使用 n8n mcp 修改工作流配置。</p>
<p>废话少说，开干。</p>
<h3>1、准备 n8n mcp 环境</h3>
<p>很简单：直接启动 mcp 服务</p>
<p>参考地址：https://github.com/czlonkowski/n8n-mcp</p>
<p>前提装好 nodejs 环境。</p>
<pre>npx n8n-mcp</pre>
<p>然后在项目的目录下新建  .mcp.json 文件，配置如下</p>
<pre>{
  "mcpServers": {
    "n8n-mcp": {
      "command": "npx",
      "args": ["n8n-mcp"],
      "env": {
        "MCP_MODE": "stdio",
        "LOG_LEVEL": "error",
        "DISABLE_CONSOLE_OUTPUT": "true",
        "N8N_API_URL": "你的n8n 地址",
        "N8N_API_KEY": "你的 n8n key 配置"
      }
    }
  }
}</pre>
<p>N8N_API_URL：你的n8n 地址，类似：https://xxx.xxx.xxx/。也就是你访问 n8n 系统的地址。</p>
<p>N8N_API_KEY：你的 n8n key 配置。</p>
<p>进入到 n8n的设置页面，在「n8n API」菜单页面进行设置就可以。</p>
<p>其实这里 N8N_API_URL 和 N8N_API_KEY 的不设置，也可以写出json 的工作流文件。</p>
<p>这里配置就是为了</p>
<p><img src="img/66664eb5b7ed971fe1eb0af79768ca00.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HIa9bAQP2oXO74xHfNccc8FonAj/"/></p>
<p>这里说下 n8n 的环境有很多种。</p>
<p>大多数的都是本地 docker 搭建的，这个大家可以看龙哥的文档，写的很详细。</p>
<p>我有云服务器，直接用的 zeabur 的模板，搭建在自己的 zeabur 管理的服务器上。很快就可以搞定环境。</p>

<h2>步骤三：写需求文档</h2>
<p>又到了这个步骤，所以说现在的开发流程并没有减少，并且对个人的要求能力越来越高。</p>
<p>因为我发现，我现在代码写的越来越好，需求文档写的越来越多了。</p>
<h3>1、n8n 工作流的需求文档</h3>
<p><img src="img/3e98f7900cedd998bba1f330e51bc645.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CBy2bRxwDo3OV1xkVticyl3JnEf/"/></p>
<p>主要就是的关键点：</p>
<p>1、写的是 n8n json 文件</p>
<p>2、使用 webhook 的触发方式</p>
<p>3、使用 ai 写博主的特殊报告</p>
<p>4、保存数据到数据库中</p>
<pre>帮我编写一个n8n的agent的对应的json文件，这个agent的要求如下：

1. 能够以webhook的方式触发，POST请求，接受的数据的结构示例如下，这其实是一份小红书中获取到的创作者的相关数据，包含作者信息和笔记信息，@data.json

2. AI Agent接收到这个数据之后，能够根据数据中的信息，分析出这个用户的一些特征，并生成一个创作者的分析报告，报告要包含以下的主题：数据概览、赛道分析、标题风格分析、笔记风格分析、热门笔记分析。把分析的报告保存到`report`字段中

3. AI Agent分析完成后，需要解析对应的数据，并且分别把数据保存到对应的表中，分别有两个表，`xiaohongshu_authors` 表和 `xiaohongshu_notes` 表，分别对应作者列表和笔记列表，结构见文件 @supabase.sql 

4. 2个数据保存成功后，能够返回一个true，如果保存失败，返回false

其他要求：
1. ChatModel 选择 OpenRouter，模型使用 deepseek
2. 报告应该体现专业性
3. AI Agent 的 prompt 要求能够完成我们上述的要求</pre>
<p>当然需求文档也是借鉴了下别人的，感谢 yihui 大佬。</p>
<h3>2、claude code开发json工作流阶段</h3>
<p>直接就艾特需求文档，让 claude code 开发了。</p>
<pre>@prd_n8n.md 根据这个文档的需求，并使用 n8n-mcp 生成对应的n8n的配置json文件，ultrathink</pre>
<p>注意：前期都是使用 plan 模式，并且我加上了 ultrathink。</p>
<p><img src="img/bbbf4edb78e838ea69114285b73fde05.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ANyYbD5dgouTy3xckI6ccEMYn9s/"/></p>
<p>得到执行计划</p>
<p><img src="img/533bd7f066bb35381e26db3b99741f8e.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WynRbyWWKoOTWwxGmd7cjMBSnbg/"/></p>
<p>其实这里可以看到有每个节点</p>
<p>后续生成的时候，每个节点都会调用 n8n mcp 获取详细配置信息。</p>
<p>这样 claude code 就知道怎么生成这个节点的配置信息。</p>
<p>特别是需要处理数据的地方，就是用代码节点，而写代码是 claude code 的强项。</p>

<p>经过开发后就成功创建了 json 的配置文件</p>
<p><img src="img/8d5b45e66a7431813701e24a04b538bd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PfW6b60g8oc5kexj23nc5haInk8/"/></p>
<p>其实到这里，我还半信半疑，这个 json 文件能用吗？</p>
<p>那我们就试试不就知道了</p>
<h3>3、json 文件导入到 n8n 工作流里面</h3>
<p>直接新建一个 n8n 项目。</p>
<p>然后找到项目的右上角的三个点，选择导入文件。</p>
<p><img src="img/b4ddcceb191db2f4597721c80f558d93.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Xw8Xb8Uq6oDKRVxuJS8cOKKAnAd/"/></p>
<p>选择我们刚刚生成的 json 文件就可以。</p>
<h3>4、设置使用的 AI KEY 信息</h3>
<p>可以看到如下界面。当时我还是惊讶了下，我啥也没干，就是写了个需求文档。</p>
<p>这个导入后居然还是像模像样的。</p>
<p>目前足矣证明claude code + n8n 的方式是可行的。</p>
<p><img src="img/3c39ccd40deb3506fbe442a52b0c9547.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ScwUblYvloZeh0xh7LJcLPUJnbe/"/></p>
<p>不过有几个节点有些红色的叉，没关系，就是需要设置下对应 openrouter 和 supabase 的信息。</p>
<p>1、openrouter 的好填，直接填 API KEY 就行</p>
<p>2、supabase 的信息</p>
<p><img src="img/41754920990cccb1d3aad4dc31c31ed1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KBc1bFgKPopbxHxTVKYcJTCgnfd/"/></p>
<p>第一个 host 的地方：</p>
<p><img src="img/67b986f43c1f83abb908832500654ba0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/UFthbBNAPoSyoFxvycuccNyCn4d/"/></p>
<p>第二个：Service role secret</p>
<p><img src="img/142394103b9472874179d7e8f1e42037.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/LMksbZ8K4oyfO8x3bqJcx6Hbnif/"/></p>
<p>填好信息后就可以看见红色的❌消失了。</p>
<h3>5、测试整个n8n工作流</h3>
<p>下一步就是测试了。</p>
<p>点击工作流下面的「Execute workflow」，就进入了测试模式。</p>
<p><img src="img/c9e2ee7ee2c97291d326f6eb508b97e0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ZTeSbjtP9olpqvxCTALcQTbLnbh/"/></p>
<p>可以看到整个工作流进入了测试模式，特别是第一个节点提示等待你的 url 请求。</p>
<p><img src="img/dc8e8e674a5d293419f610e49e2b29c4.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/V7WAbdWvBoeTx0x90GYccnS7nLh/"/></p>
<p>点击第一个 webhook 的节点</p>
<p>就可以看到「Test URL」模式下的，一个 http 地址。</p>
<p><img src="img/e7981bc5fc2581b8547d5fb6309e2aed.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WF8bbJ6QGoDHlfx7YPocsv5Rnlg/"/></p>
<p>复制这个地址，我们使用前面提到的 ApiFOX 工具进行测试。</p>
<p><img src="img/8b9ef805e65ab32f4e0a9ac9fae8c968.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HupRbaeuMof676xUowkcmTfNnxb/"/></p>
<p>当 APIFox 的「发送」按钮操作后，就可以看见我们的工作流跑起来了。</p>
<p><img src="img/f86cc9f41a6ed3a845286429631b80f6.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/YHWObHAICo81LkxqPINcrj4Knrz/"/></p>
<h3>6、修复n8n 工作流节点的错误</h3>
<p>可以看到运行过程中会有节点报错</p>
<p><img src="img/7cff13692ba1c1273967e28480f339bc.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WnhWbAKVIobsG1x7TYWcQyalnGd/"/></p>
<p>我们点开具体的节点，就可以看到具体的错误信息：</p>
<p><img src="img/b17f37179144c52ad219510eef00099f.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Iyjbbw7fZoiYkdxsvpFcCLx8nYg/"/></p>
<p>可以看到是数据太多。</p>
<p>这类就要看之前浏览器插件采集到的数据。</p>
<p>前面我们采集了评论数据，但是没有做清理。这里为了处理方便，我门就先不处理这个评论数据。</p>
<pre>接收到的数据里面有noteCommentsHtml评论数据，比较大，看是否可以先过滤掉，加一个过滤节点</pre>
<p><img src="img/939f4852a3a3a8a3bc5f258eabd92b4a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/G80xbfdRWoRHO9x1d4tcd1cCnKh/"/></p>
<h3>7、修复数据库唯一键冲突报错</h3>
<p>这里还有个问题就是，数据库里面已经存储过的数据</p>
<p>再次执行的时候就会报错。</p>
<p>可以看到是唯一键冲突了。这个是数据库的特性。</p>
<p>这里我还是想处理下，也就是想让他支持 upsert 模式。</p>
<p>upsert 模式：就是没有数据就新增，有了数据就更新</p>
<p>唯一键：就比如身份证号，整个表里存储的数据每个人的记录有且仅有一条。没有这个身份证号的数据，就新增，有了，就更新这个条记录的数据。</p>
<p><img src="img/216647bb09a410bed226fb1c6a4edaff.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/OH3Db5HNtoe58uxhXrtc23OPnYb/"/></p>
<p>所以这里想改成 upsert 模式，就是没有新增，有记录就更新</p>
<p>那这里我们采用的模式就是，直接更新工作流。</p>
<p>这个也是 n8n mcp 的工作流也支持的，调用了 n8n_update_partial_workflow 的方法。</p>
<p><img src="img/d486d47a7efe886b079ae5e912359a6d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/SKVbbrWnRoIOhdxCigqcGtYBnp6/"/></p>
<p>我加入了 ultrathink 模式，让他深度思考，避免修复错误。</p>
<p><img src="img/cc4299f81b0c83cb0c323f0f4b9c8d40.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Gz5xbDOgDoE7qGxab4EcRETbnvh/"/></p>
<p>最后发现改了还是有错</p>
<p><img src="img/52af930428ab92a6b5c4e1d2ce766ee0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/W13mb5MpWoDjbwxWOmXcmgwqnPH/"/></p>
<p>继续修改：</p>
<p><img src="img/41fc302c8231b76f5b94c8ae23b8b9cf.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/IUDOb9QTnoVSsOxht18cxB9Lnwh/"/></p>
<p>并且我还装了 supabase 的 MCP 的好处就是可以看到可以查询 supbase 的文档。</p>
<p>确认 supbase 的 upsert 模式如何写。</p>
<p><img src="img/e2b9871424ee875c3e81c13c2e9f68e0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/DLoJbHW0foQXvhxNts7cyIKRnJe/"/></p>
<p><img src="img/7dc59bf5d244e786bcf462a6935f8b9e.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/MIFMbaFBqojoVaxS2sMc7fqknbf/"/></p>
<p>最后其实使用了自定义的方式，也是 通过 supbase 的文档获取到可以执行。</p>
<p>并且通过 n8n mcp 知道 supbase 节点无法做到 upsert 操作。</p>
<p>最后 claude code 自动生成 http 节点，绑定 supabse 的auth信息，同时可以进行 supbase 的 upsert 操作。</p>
<p>修复完成！</p>
<p><img src="img/c34fd60344007a1d61e386fa7ebdb2ef.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ULsmbwXjPoKkJVxt3X1coTc7n5c/"/></p>
<h3>8、这里其实还有个比较棘手的问题</h3>
<p>就是保存了笔记数据，和博主的数据后，使用的是一套逻辑，那么判断就会出错。</p>
<p>比如判断了笔记数据 ok 后，博主的数据就判断异常，其实两部分的数据都是 ok 的。</p>
<p>继续问题排查</p>
<pre>"检查保存状态"这个节点，因为检测的是“作者“和“笔记“的前置两   
   个节点，检测代码写的是通用的，运行的时候只会满足一个情况，   
   比如检测作者数据的时候，就会返回[                            
     {                                                          
       "success": false,                                        
       "message": "数据保存失败",                               
       "errors": [                                              
         "笔记数据保存失败"                                     
       ],                                                       
       "authorSaved": true,                                     
       "notesSaved": 0,                                         
       "timestamp": "2025-08-20T09:00:42.892Z"                  
     }                                                          
   ]，检查笔记数据的时候，就会返回[                             
     {                                                          
       "success": false,                                        
       "message": "数据保存失败",                               
       "errors": [                                              
         "作者数据保存失败"                                     
       ],                                                       
       "authorSaved": false,                                    
       "notesSaved": 114,                                       
       "timestamp": "2025-08-20T09:00:42.934Z"                  
     }                                                          
   ]，帮我重新想下这个方案如何设计好，ultrathink                
</pre>
<p><img src="img/f648fc077b4f6b13793fd3474b77fd5b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/OeR4bB853or3bXxouItceM43nUc/"/></p>
<p>让 claude code 给出方案：</p>
<p>解决问题：</p>
<p><img src="img/697d07f52402cc14c24e12b362223a1e.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FV77bRbUYor5p3xXOL6cDKIqnBc/"/></p>
<h2>最后的总结</h2>
<p>其实到这里，你会发现，我并没有去 n8n 的界面配置任何工作流。</p>
<p>我也不知道这些节点是什么、是干嘛的，有哪些参数配置，通通不知道。</p>
<p>都是 claude code 生成后，我才去看这个节点是干嘛的。</p>
<p>这里总结核心的点：</p>
<p>1、对 claude code 说明白你的需求点，比如生成 n8n 的 json 文件</p>
<p>2、配置好 n8n mcp 工具，需要他获取真是的 n8n 节点文档配置数据</p>
<p>3、及时备份好工作流，直接就右上角三个点导出 json 文件就行。</p>
<p>这里其实更想说的就是学习能力以及和解决问题的能力。</p>
<p>这是我们在 AI 时代每个人都需要进行锻炼的能力。</p>

<h1>第三部分：像素红薯开发</h1>
<p>偷偷告诉你，这里的模式是先难后易，这一部分是最简单的了。</p>
<p>终于到了第三阶段了。这里其实就可以松一口气了。</p>
<p>进入休闲时间，也是大家的都可以搞定的环节。</p>
<p>这个阶段的重点如下：</p>
<p>1、开发一个 web 系统，读取数据库的小红书数据，展示就行</p>
<p>2、模仿对标写文章，就是调用 AI 接口。</p>
<p>3、文生图，根据参数生成小红书配图，也是调用 AI 文生图接口即可。</p>
<h2>步骤一：生成项目骨架</h2>
<p>最快的开发方式，还是基于模板代码去开发，基本环境一步到位。</p>
<p>直接使用 claude code 就进入业务需求开发。</p>
<p>直接使用模板代码生成项目</p>
<p>如果你不懂，没关系，这个模板里的代码我也没看过。</p>
<pre>pnpm create next-app --example https://github.com/vercel/examples/tree/main/storage/postgres-drizzle</pre>
<p>接下来填写下自己的项目名称就可以</p>
<pre>xiaohongshu-n8n-web</pre>
<h2>步骤二：写好需求文档</h2>
<p><img src="img/8d42ec90d89675fbcf5de21766b84ceb.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/AhzRb5ctyoYcCrxEYg1cLIkkntg/"/></p>
<p>其实重点就是理清你需要的功能。</p>
<p>以及具体的数据交互逻辑。</p>
<p>这里也感谢 yihui 大佬的提示词给到的灵感，还是很牛批的。</p>
<pre>网站名称叫做：像素红薯。

网站功能如下：

1. 首页是从 xiaohongshu_authors 表中获取对应的数据，然后以卡片方式渲染，响应式一行最多渲染2个，移动端渲染1个卡片，点击作者名称能够新窗口打开链接 profile_url。同时卡片中有一个报告的icon，右侧出现报告渲染report 字段，report 字段为markdown格式，要求使用markdown的渲染库实现渲染。

2. 点击作者卡片后，能够进入到作者的详情页面，顶部显示 xiaohongshu_authors 中的相关数据，同时请求notes表的数据，获取对应 author_id 的笔记数据情况并渲染。同样是以卡片渲染。卡片展示所有文案，不要多行省略。

3.在作者详情页面需要有一个AI小红书笔记仿写的的功能，使用对应的icon，点击后能够弹出一个几乎全屏的弹框。左侧是配置页面，在配置页面用户能够配置是否添加emoji表情，有一个多行文本框，这个多行文本框允许用户输入主题和想要创作的内容，同时又一个【仿写】按钮，点击后请求后端接口，开始实现仿写功能。右侧是AI仿写的小红书笔记的生成区域，使用流式输出实现AI给出对应的笔记

4. AI功能使用智普大模型，使用OpenAI SDK，base_url:https://open.bigmodel.cn/api/paas/v4/, api_key为环境变量中的 ZAI_API_KEY，使用 process.env.ZAI_API_KEY。务必使用流式输出，模型使用：glm-4.5

5. 你需要编写对应的系统提示词和用户提示词，提示词中你还需要携带上改作者的notes这张表的数据，用于更好的参考原先的内容实现仿写

6. 网站使用 tailwindcss + shadcn/ui，要求UI样式魂斗罗的像素风格，有一定的微动画效果，颜色主要以🍠颜色为主题色。

7. xiaohongshu_authors 表和 xiaohongshu_notes 表结构见 @docs/supabase.sql，集成Drizzle ORM
</pre>
<p>这里重点说下，其实到这里我们看到了，这三部分的需求文档其实会很占用我们的时间。</p>
<p>1、想清楚你需要的功能，尽可能的详细，详细到有个 icon 都说清楚</p>
<p>2、用到的技术框架，也最好指定</p>
<p>3、使用的数据，指定表，以及交互组件</p>
<p>4、整体的网站风格。</p>
<p>5、指定好对应需要的 sql 文件和接口文档。</p>
<h2>步骤三：根据需求文档进行开发</h2>
<p>到这里还是一样的步骤，让 claude code 根据需求文档进行开发。</p>
<pre>@docs/prd.md 根据需求文档，开发这个网站，ultrathink</pre>
<p>还是依然在 plan 模式下，加入 ultrathink 深度思考。</p>
<p><img src="img/609beb24435487451ff6061e737aab35.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/OQwtbdf94ostDMxrtnAcGDKynsh/"/></p>
<p>开始执行计划</p>
<p><img src="img/3da5106b6120eacc39c01bdc3096abaf.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/C0jdbKPGUoulqGxYb3wc4tdtnFc/"/></p>
<p>到这里放松下吧。</p>
<p><img src="img/b6b472d23525d1281f09994be947b549.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/OrDvbBl3comoppxkAgTcEFKQnUg/"/></p>
<p>等待完成就可以了。</p>
<h2>收菜验收</h2>
<p>吃了点下午茶就准备收菜了</p>
<p>一进首页，目前看还不错哦。像素风，🍠的颜色，哈哈哈，一模一样的 icon。</p>
<p><img src="img/f59f529c2098f5dc2921a07bda21ddfd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RPSrbwgLeo6QdtxuzjJcFZbHnbc/"/></p>
<p>但是。。。。就遇到了错误</p>
<h2>步骤四：修复错误</h2>
<h3>1、”查看报告“的时候错误</h3>
<p><img src="img/695a65c19c9740d1f617fe90fbce01b4.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Dv7obG8UfoCgx1xli3SctaBGnNO/"/></p>
<p>直接复制页面上的复制按钮</p>
<p>粘贴到 CC 的对话界面中</p>
<p><img src="img/64b0b52f5248cf23466b1fe235d59591.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PAetbnTVBo6AJ1xgQcKcfUuCn7e/"/></p>
<p>就可以回车解决了。</p>
<p>解决后就可以看到个人的界面：</p>
<p><img src="img/64c8a4e40417eab2eb1ea862d9ff7476.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CNHKbt2KQoqmdDxqABDc01eCnrf/"/></p>
<h3>2、笔记列表为 0 的情况</h3>
<p>可以看到笔记列表为 0 的情况，那么直接告诉 claude cod 就可以。</p>
<p><img src="img/f5bb14b559793b81a4ebfc6e1d4152e2.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/W5iqbeheSoktcvxMgMicg1umn9c/"/></p>
<p>可以看到根据 claude code 的描述，可能是关联字段搞错了。</p>
<p><img src="img/29acfbd5e4fdf4824d5aab198319a25a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/L8xVbCiz9oDwW2xvY93cNuFdnSg/"/></p>
<p>最后也是可以顺利解决。还很亲切的给我们删除了调试日志。</p>
<p><img src="img/23a922674a9001ffe3b41479647118cc.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/NX4nbNAEvo2Ip3xNcHlctgyznXd/"/></p>
<h3>3、仿写功能异常</h3>
<p>最后仿写功能的时候，也会异常</p>
<p>我们粘贴异常信息，再加一点提示词。</p>
<pre>仿写的时候报错：ai-rewrite-modal.tsx:90 生成失败: Error: 生成失败at handleGenerate (ai-rewrite-modal.tsx:55:15)</pre>
<p><img src="img/22e062d7d3be6112bbff380f4de506e3.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Lip0bpLZaorKUzxWPy4cnOLEnKb/"/></p>
<p>还有个小插曲。居然检测出我的 glm 账号的余额不足。</p>
<p><img src="img/d63f1b9ebefa9de203d44ce47a9a4730.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TuoJbq491ovMQtxEQpdcEKAKnzd/"/></p>
<p>看了下我的账户余额不足。先充电吧，完成功能。</p>
<p>最后记得</p>
<pre>commit push</pre>
<p><img src="img/0b8b4ca459d59e64e695baecaaa09fd4.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ARjhbg4rAobub7xk1wUcKbx7npd/"/></p>
<p>效果如下：</p>
<p><img src="img/b3d908110d9eb8cb4b4dd47ad24c6cbd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/DRqnbRwjPo4Zk4xYDv2cGhUEnJ4/"/></p>
<p>这里借用的是 glm 的模型</p>
<p>这个在需求的文档里写的就很清楚了。</p>
<pre>4. AI功能使用智普大模型，使用OpenAI SDK，base_url:https://open.bigmodel.cn/api/paas/v4/, api_key为环境变量中的 ZAI_API_KEY，使用 process.env.ZAI_API_KEY。务必使用流式输出，模型使用：glm-4.5
</pre>
<p>其实这里最好就是的就是把接口文档，保存到本地的 api-glm.md 文件中，这样 claude code 读取会更准确。</p>
<p>避免 claude code 可能读取不了链接的数据。</p>
<h2>步骤五：接入文生图的模型</h2>
<p>只用最近很火的 qwen 的生图模型</p>
<p>https://www.modelscope.cn/models/Qwen/Qwen-Image/summary</p>
<p>不过我尝试让claude code 讨论下这个模型怎么用</p>
<pre>https://www.modelscope.cn/models/Qwen/Qwen-Image/summary
这个生图的模型怎么使用了？</pre>
<p><img src="img/0275390b0425ad43450485f7ee065a4d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/MMXvbdg00oXb7vxyiRzcjMQvnD9/"/></p>
<p>不过后来开发我打算让 claude code 直接读取这个连接的文档</p>
<p>就是开发了后一直不对</p>
<p><img src="img/79418d7f1d6931bf80d2d400c2f81303.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/QxPtbeDEuosGHuxQt4mcGxmWn1d/"/></p>
<p>没办法，就只能手动粘贴文档了。</p>
<p>我还特意粘贴上了文档中的示例代码（虽然是 python 的，但是 claude code 是可以理解的。）</p>
<pre> @docs/api-modelscope.md 这个是modelscope的api文档，这个是文生图的示例代码：</pre>
<p><img src="img/fd3856f981868962a519c642e9dc14bd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/SOWbbaLgqo0yARxslrbcZNBwnUb/"/></p>
<h3>错误：绑定阿里巴巴账号</h3>
<p>这里有个问题就是需要绑定阿里巴巴的账号</p>
<p>其实刚开始我不知道，我就继续和claude code 聊错误。</p>
<p>它就会帮我排查接口，通过接口返回的信息给出我提示。</p>
<p><img src="img/fa0998388bd1d0c599b2d385d861c12e.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PolDbFLc9oRHyQxgID1cFAuvnOd/"/></p>
<h3>错误：自动修复尺寸符号问题</h3>
<p>接下来继续测试接口</p>
<p>发现了尺寸的符号是 x 而不是*号的问题。</p>
<p><img src="img/b9d17e6643e85f2e93087047ba073f26.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FFAqbgbbhoeMkGxzLapcTg7Gn6n/"/></p>
<p>最后完美手工</p>
<p><img src="img/fffdc1e02df0f354948a1b7b607ebac6.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CB8EbUY5qoHPlUxfscicALzbnwe/"/></p>
<p><img src="img/6123973f0794465944b4d75d0cbb3381.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RDwzbpQxbo0kpGxo8EecCw4snYd/"/></p>
<h2>步骤六：提交代码</h2>
<p>这里就说了最后的一次的提交代码</p>
<p>基本上我做完一个小功能，或者解决基本问题后。我都会进行提交</p>
<p>养成提交代码的好习惯是整个过程所需要锻炼的。</p>
<pre>commit push</pre>
<p><img src="img/b8b866c20a54eaa8af8ffdb19a2ec3d3.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/XUI9bCNiso7bcOxXCTIcge4wnne/"/></p>

<h1>总结</h1>
<p>到这里基本就完事了。这么样，感觉可否还行</p>
<p>按照管理还是来个总结吧。</p>
<p>AI智能体+AI 编程绝对是今年爆火的赛道。</p>
<p>那么体现来自于哪里了？</p>
<p>我觉得就是 claude code + n8n 的结合。</p>
<p>一个是编程界扛把子</p>
<p>一个是智能体的新星</p>
<p>加上出海的赛道爆火。</p>
<p>这就是 claude code + n8n 的魅力。</p>
<p>那么到底该怎么弄了</p>
<p>1、学好 AI 工具，用好 AI 工具，我这里就无脑推荐 Claude Code + n8n 了</p>
<p>跟 AI 一起学习或者找大佬一起学习。</p>
<p>2、找清楚你的需求痛点，弄明白你的需求文档，越细越好，一定要人工审核确认好。</p>
<p>3、干中学！干中学！干中学！</p>
<p>4、做个垃圾！做个垃圾！做个垃圾！</p>
<p>5、复盘！复盘！复盘！</p>
<p>原谅我重要的事情说三遍，其实就是这么简单。</p>
<p>增强你的学习能力以及问题处理能力</p>
<p>搞懂需求</p>
<p>剩下就是干就可以了。</p>

<p>如果你有遇到什么问题，都可以来找我，欢迎跟志辉一起交流讨论！</p>

<p>最后感谢生财！跟很多大佬一起学习，也在积极反哺大家，跟大家一起在这个时代打下属于自己的一片江山。</p>
