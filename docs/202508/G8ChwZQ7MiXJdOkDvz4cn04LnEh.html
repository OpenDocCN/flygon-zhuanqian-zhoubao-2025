<h1>n8n工作流本地部署小白零基础入门，附徒手搭建AI字幕违禁词敏感词优化工作流案例</h1>
<blockquote>来源：<a href="https://a0u2vshvubw.feishu.cn/docx/QYs0dJfmgosw78xL5BfckbIunib">https://a0u2vshvubw.feishu.cn/docx/QYs0dJfmgosw78xL5BfckbIunib</a></blockquote>
<p>读完这篇文章，如果你没有学习过n8n，那么我将会手把手带你实现n8n的安装和搭建。</p>
<p>如果你会n8n，你将得到一个 视频字幕优化工具，彻底解放眼睛，自动优化过滤违禁词，更改错别字。</p>
<p><img src="img/c700fe350b5e527dad14dc46b9de7066.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KEqWbi29BoudhsxiRQdcRIlnnph/"/></p>
<p>废话不多说，教程开始：</p>

<h1>N8N部署准备工作：</h1>
<p>一台可以联网的电脑。</p>
<p>电脑安装nodejs环境，没装也没事我会带着你装。</p>
<p>一个安静轻松的环境，空闲时间30分钟以上。</p>
<p>一个视频，最好有脏话、敏感词，用来测试工作流效果。</p>
<h1>安装教程开始：</h1>

<p>注意苹果版本和win安装方式大致一样，nodejs和nvm以及n8n都是跨平台的，苹果和win方法都是一样。</p>

<p>命令能复制就复制，不要去自己手打，还打错！</p>

<p>用CMD , 不要用Windows PowerShell</p>
<h2>安装nodejs</h2>
<p>这里我们不讲传统的安装方式，我们讲一个很酷的安装方式，就是通过【nvm】去安装。</p>
<p>nvm是一个nodejs版本控制器，它可以在电脑上安装多个不同版本的nodejs，并随时切换使用不同版本的nodejs。</p>

<p>nvm下载地址：Releases · coreybutler/nvm-windows</p>
<p><img src="img/4e1822e5e4d87820454ee528edbba671.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/F9eqbcxRZoc22VxkW35cXDq9nBf/"/></p>
<p>因为进入git要魔法,这里我帮大家下载好了.</p>


<p>苹果版本安装nvm教程：https://www.bilibili.com/video/BV1paZzYqEQ9/?spm_id_from=333.337.search-card.all.click&amp;vd_source=0938c92d0bed0dc8d6956f9d2e97ea39</p>

<p>因为我苹果电脑卖了，没办法演示具体步骤，B站一堆教程，多搜搜，总能找到的。</p>

<p>以下步骤win和苹果通用，如果有问题联系我，优化文档。</p>
<p>安装成功之后，我们测试下：Win+R 在运行输入cmd，打开命令行，</p>

<p>管理员命令行：</p>
<p><img src="img/7fae5e8a9054fac3ee062b577adedd38.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HxQPb2E9wowRqnxV093c3PWZnaf/"/></p>

<p>输入： nvm -v，出现数字说明安装成功。</p>
<p><img src="img/acbbe9fc35f5db27786cda9b1220422c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/NW78bb3I0oODHFxmNr1cZaotnse/"/></p>
<p>然后安装nodejs，输入：nvm install lts ，这个意思是安装长期支持版本的最新版nodejs。</p>
<p><img src="img/4c525179f84608c8b57ddfd2e05b4871.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/LeNIb2PdboRuwTx3YTKc1V86njU/"/></p>

<p>安装完了之后，我们可以看看电脑现在有几个nodejs，输入：nvm list</p>
<p><img src="img/e26d89c77259c5b74310171e7a2b13c5.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/VHdzbll7hoAm6ixT8WVcki7qn2d/"/></p>
<p>我这边是装了两个版本，所以会显示两个，前面有星号代表目前正在使用的版本，</p>
<p>我们要切换版本，输入：nvm use 22.18.0（这里输入你的版本号，不要完全复制）</p>
<p>不管你装了几个版本这一步必须输入，不然系统不知道你要用哪个版本的nodejs。</p>
<p>输入：nvm use 22.18.0  （这里输入你的版本号，不要完全复制）</p>
<p>输入：nvm use 22.18.0  （这里输入你的版本号，不要完全复制）</p>
<p>输入：nvm use 22.18.0  （这里输入你的版本号，不要完全复制）</p>
<p>老是有人忘记敲这个命令，我写三遍！！！</p>
<p><img src="img/1245658e422f707705923e294a34da6b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/UxOvbQQQIoLizNxRwk3cV0mwnBg/"/></p>
<p>然后我们输入：node -v 看看是否成功切换</p>
<p><img src="img/35352156867e1c2eb7f6640f69ee9af3.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PNc4b4GIZoiUFWxhbfEcVvq4nUh/"/></p>
<p>这里要特别注意，n8n对nodejs的版本要求很高，20.11.0都不行，所以推荐安装并切换最新版</p>

<h2>下载安装n8n：</h2>
<p>打开命令行输入：npm i -g n8n ，然后会自动下载安装，大概需要三分钟左右，完事之后还是老样子</p>
<p>输入： n8n -v  看版本号。</p>
<p><img src="img/3e3fdb17b1fa356895cfdb3cce3f8eea.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Avg0bGHiooPQrexeOvPcl1KGnih/"/></p>

<p>上面卡住或者无法下载必看：</p>
<p>因为npm源地址默认是海外服务器，受众所周知的原因，速度非常慢，甚至无法下载，这可以有两种解决方案。</p>

<p>一、给命令行或者终端设置代理</p>
<p>如果你是一个追求高雅生活品质的人，那么你可以选择这个办法，它的做法非常不简单，</p>
<p>首先你要找到你用的魔法软件的代理端口</p>
<p>什么，你说你不知道！！！那你还是用方法二。</p>
<p>知道端口之后，打开你的命令行输入以下两条命令：</p>

<p>npm config set proxy http://127.0.0.1:7890</p>
<p>npm config set https-proxy http://127.0.0.1:7890</p>

<p>注意：这里的7890要换成自己魔法的端口</p>
<p>注意：这里的7890要换成自己魔法的端口</p>
<p>注意：这里的7890要换成自己魔法的端口</p>

<p>取消终端代理命令(你安装好n8n之后可以考虑按需取消代理，这个命令可以不执行，不影响安装)：</p>
<p>npm config delete proxy</p>
<p>npm config delete https-proxy</p>

<p>二、用淘宝镜像</p>
<p>直接无情输入：</p>
<p>npm config set registry https://registry.npmmirror.com</p>
<p>这个是用国内的镜像网站，有更新慢，兼容差的缺点，唯一好处是就算没有魔法，下载也快</p>

<p>恢复海外版命令(你安装好n8n之后可以考虑按需恢复，这个命令可以不执行，不影响安装)：</p>
<p>npm config set registry https://registry.npmjs.org/</p>

<p>注意： 这里的命令输入，正常就是没有反应的，正常下一步就行，这里只是切换了下载源，你还要再次输入：npm i -g n8n</p>

<h2>打开n8n：</h2>
<p>命令行输入：n8n，然后等待跑数据，直到出现如下页面：</p>
<p><img src="img/bad2c5811476acc30d2ab2cedb724baf.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/LQ63b7kwpowwctxofIOcGRBjnIh/"/></p>
<p>红框中有个ip地址，这个就是打开n8n页面，把它复制到浏览器就可以打开了，也可以按键盘的【o】自动打开。</p>
<p>以后每次要使用n8n网页，都要输入这个命令。</p>


<p>安装教程到此就结束，后续是一个简单的案例。</p>





<h2>工作流思路：</h2>
<p>开始工作流之前，我们讲一个思想上的东西，就是不管代码还是工作流，</p>
<p>它们的本质就是把我们的想法思路翻译成机器可以理解的东西，</p>
<p>所以我们在写代码或者搭建工作流之前，必须要有一个大概的项目思路。</p>

<p>对于今天这个字幕优化的项目，我的思路是这样：</p>
<p>1、剪映导出字幕文件，一般是.srt格式。</p>
<p>2、把字幕文件上传到工作流。</p>
<p>3、解析字幕文件成文本格式。</p>
<p>4、把文本格式的字幕通过api接口发送给ai，并写处理的提示词，也可以接入专门的敏感词库和错别字API。</p>
<p>5、返回文本字幕文件并转成.srt文件。</p>
<p>6、下载处理过的.srt字幕文件。</p>

<p>这里只做一个思路上的分享，详细步骤在下面，我们有了这些思路就可以把思路翻译成工作流。</p>

<h2>搭建步骤：</h2>
<h3>一、上传字幕文件到工作流</h3>
<p>我发现n8n这个工作流好比一个后端，它主要是处理数据，只能接受数据，是没有上传的渠道的，</p>
<p>所以我们得借助html这个网页实现上传功能，网页我已经整理好了，用之前改一下接口路径即可，</p>
<p>具体改什么后面会讲。</p>
<p>然后我们开始处理工作流第一个模块，【接收上传的字幕文件】。</p>
<p>新进来应该会让你填邮箱，然后发一个激活码到你的邮箱，去邮箱激活即可。</p>
<p>到首页了，点上面的【 Create Workflow】创建新的工作流。</p>
<p><img src="img/5b0e035f2fb1d7afa35dc89914dc7ada.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Fb9LbBdcqop60kxIQMzco5MGncc/"/></p>
<p>点击中间的【+】在右边输入框输入：【web】 ，然后点击下面选项的第二个【web hook】，</p>
<p><img src="img/ade0196273cec5659db5e543630fe0c8.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Sls6bMOPuoCzutxjHGAcxArFnyd/"/></p>
<p>进去之后把目光聚焦在中间，把红框的两个地方改成和图片一样。</p>
<p><img src="img/5ccd22ef5159c25b9b7afac433d71d51.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/UIeobVtZ6o0Z8pxmbs9cvCsgnC8/"/></p>
<p>第一个是改请求的方式，因为我们是传输文件，文件属于大件货物，GET请求装不下，所以必须用POST方式传输。</p>
<p>第二个是路径，因为我们要给工作流传文件，必须有个地址才能准确传达，这个可以随便写，但是后面网页发文件地址必须和这个一样。</p>
<p>填完之后直接点击上面的，【Back to canvas】返回，编辑的信息会自动保存。</p>
<p><img src="img/130a0429ac628c189d02ff7bb4564d3a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/QY4TbNg9LotKCtx4F9TcgVO9nmd/"/></p>

<p>这个东西一旦启动，它就会创建一个 接收字幕文件的接口 ，这个接口你可以理解成是工作流入口大门，你的字幕文件只有从这个大门进去，工作流才能处理你的文件。</p>
<p>然后出去之后是酱紫，我们点击下面的按钮。</p>
<p><img src="img/6e8473dd3bef8c8b6e1c4708475d02ff.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/EJoIb63tAodIovxPVvzcj78wnjf/"/></p>

<p>它会变成 【Waiting for trigger event】，嘛意思呢？</p>
<p>意思是：“小老弟，我已经等着接受你的文件了，快点赶紧给我传文件哈。”</p>
<p><img src="img/04910e727c4ece8640ddf84888351b26.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/M0HObqmTGog5vfxrrbycENMVnHg/"/></p>

<p>这个时候，你就可以掏出你的编辑器打开我给你的html文件，什么？你说没给你！</p>
<p>出去罚站25个小时！往上刷，在第一步刚开始，我就发文件了。</p>
<p>我们右键文件，然后点【打开方式】，有编辑器用编辑器打开，没有编辑器用记事本打开，修改红框的地址。</p>
<p><img src="img/737504007b5be75980fbc17e1d792409.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/NB8YbYAg9oMUrNxXqCOc5olVnof/"/></p>
<p>改成刚才第一个工作流模块webhook里的链接，</p>
<p>特别注意：所有工作流模块都可以双击打开查看编辑。</p>
<p><img src="img/21bbe1601d2aeb1e20002ecea341e48c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/MGklbCOUwoiSmAxN9n4ciFaDnbc/"/></p>

<p>然后我们html打开文件，然后选择自己的字幕文件，然后点击上传。</p>

<p><img src="img/5a884d90caf17c9fe7cdfb6904a3b2c8.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/WXZbbdLg2oQHLwxttQlcqPnvnle/"/></p>

<p>突然！你就会发现工作流有变化了，右下角有提示，第一个工作流模块有绿色的边框和对勾，代表成功接到文件。</p>
<p><img src="img/50386e14907339b19ac59d18920ca24a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Lsn7b3KO9oOCtDxXoVXcU7kJnvg/"/></p>
<p>我们双击打开 webhook 工作流模块，可以清晰的看到，右边是我们成功上传的文件。</p>

<p><img src="img/cbdf92e35d34bb88311ee5103665de05.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/YJt8bJQ6XobcD5x5DpPczRUon39/"/></p>

<p>这个文件是这个模块的终点数据，也将是下个模块的起点数据。</p>
<p>至此呢，恭喜你，完成了工作流的第一个模块，字幕文件上传！</p>
<h3>二、将字幕文件变成字幕文本</h3>
<p>第一步工作流拿到了文件现在就要开始处理文件了。</p>
<p>webhook默认接收文件的方式是二进制，</p>
<p>所以我们这一步要做的就是把二进制文件变成文本文件，以便于发给AI大模型读取优化。</p>
<p>点击webhook旁边的加号，在右边搜索【code】，选择第一个code</p>
<p><img src="img/90d013914d3e0322d25ddbe3c9bee4ce.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PXI3bf89Dog6K4xrgpVcg23Mnpb/"/></p>
<p>然后进来我们会看到三个板块，分别是【预处理文件INPUT】、【处理文件代码Code】、【处理后的文件OUTPUT】。</p>
<p><img src="img/c11b98052bccb027d09009839cf1fd9c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/I8dDbbCcRoPGxhxepaGc2FzLnke/"/></p>
<p>之前我们说了，我上第一步上传的文件是第一个工作流模块的终点数据，也是第二步的起点数据，</p>
<p>所以你会看到INPUT它是有一个数据文件的，这个文件就是我们上传的二进制文件，</p>
<p>我们要写的代码就是来处理这个二进制文件，后面的OUTPUT不用管，只要代码没报错就会把执行结果显示出来。</p>
<p>所以我们中心要放在处理中间的code板块上。</p>

<p>code板块要改动两个东西，一个是mode，我们默认第一个就行，它的意思是这里写的代码执行方式，</p>
<p>第一个选项Run Once for All ltems：代码是只执行一次。</p>
<p>第二个选项Run Once for Each ltem：根据INPUT输入项的数量，每项都执行一次。</p>
<p>因为我们工作流INPUT只有一个文件，所以选第一项Run Once for All ltems。</p>
<p><img src="img/145a5f5a5038435402821e5873d1fc85.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/VWH1bghUmoacX8xKiAGcjD7tnJc/"/></p>
<p>代码：</p>
<p>return (async function () {</p>
<p>const itemIndex = 0;</p>
<p>const item = $input.all()[itemIndex]; // ✅ 用 .all() 获取第一个 item</p>
<p>const binaryPropertyName = Object.keys(item.binary)[0];</p>
<p>const binaryData = item.binary[binaryPropertyName];</p>
<p>const buffer = await this.helpers.getBinaryDataBuffer(itemIndex, binaryPropertyName);</p>
<p>return [</p>
<p>{</p>
<p>json: {</p>
<p>fileName: binaryData.fileName,</p>
<p>mimeType: binaryData.mimeType,</p>
<p>content: buffer.toString('utf8'),</p>
<p>}</p>
<p>}</p>
<p>];</p>
<p>})();</p>
<p>原来的代码全部删除，复制上面这个代码。</p>

<p>执行，点击【Execute step】按钮，运行这个代码。</p>
<p><img src="img/5e0a65dc4a903530c73098e52713a37d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/VpQ1bQAdKoJFS4xpiLTcTz39nTb/"/></p>
<p>不出意外的话，你的OUTPUT板块应该会出现如下的信息，代表解析文本成功，同时右下角会出现成功的提示。</p>
<p><img src="img/746d8c52762f216668c51fb1e19a1f5d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FhK3btCOQoGbIFxlwrgcwcfVn9g/"/></p>
<p>至此，恭喜你完成了第二个工作流模块，二进制文件转文本文件。</p>
<h3>三、把文本格式的字幕通过api接口发送给ai，并写处理的提示词</h3>
<p>我们点击左上角返回，会看到前面两个工作流模块都变绿了，现在我们来处理发送字幕文本给AI。</p>
<p><img src="img/31fa19ef69ba1d4d913bdc469e47afdd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Dxh7ba1s0o4eNEx80t2ckjKtnSd/"/></p>
<p>AI这里，可以选择的就很多了，如果你电脑是RTX3060以上显卡，完全可以部署本地模型，作为AI处理接口，</p>
<p>这个不是这期重点，我不就不多讲了，如果需要可以评论区留言，会考虑写一篇。</p>

<p>第二个方式就是用在线API，想要效果好，就接chatgpt或者claude的大模型，</p>
<p>我这里考虑到性价比就用阿里的【通义千问】模型。</p>
<p>获取API key地址：大模型服务平台百炼控制台</p>

<p>获取到密钥之后咱们就正式开始，因为要给大模型发请求，所以我们第三个工作流模块选择 HTTP Request 模块。</p>
<p><img src="img/de77b0d0de1975ca0690586c50114132.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PNdebNWAYoxubexR2gIcyD02nvx/"/></p>
<p>进去之后有四个地方需要改：</p>
<p>1、请求方式，这个方式还是post，因为我们传的数据量很大，不能坐飞机，得轮渡。</p>
<p>2、请求地址 ， 这个就是AI大模型的地址，你想让AI给你处理数据，你得知道它家住哪里吧。</p>
<p>3、头部信息， 这个就是校验信息，证明你是谁家的数据，AI看你有额度才会给你处理，不然不理你。</p>
<p>4、参数， 这个就是具体的字幕信息和提示词了。</p>
<p><img src="img/2dd2135b0b5ac7cbd75c4074adb7a0e2.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HMO9bltBlocZ8AxGdySc7SltnJe/"/></p>
<p>请求方式、请求地址和请求头填写如图：</p>
<p><img src="img/62a6af49fa40836b9280cd0e018a215b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/CKQWbCNplotEa8xG3WxcQ8n5nqb/"/></p>
<p>请求地址：https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions</p>
<p>上面黄色框要填入你在大模型服务平台百炼控制台获取的api key。</p>
<p>然后 send body 如下：</p>
<p><img src="img/cfdb6102a6bc040184c47ea2499eb52d.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TCWzbB7cHofF9mxNXBQcyivcnyh/"/></p>
<p>JSON里代码：</p>
<p>{</p>
<p>"model": "qwen-turbo",</p>
<p>"messages": [</p>
<p>{</p>
<p>"role": "system",</p>
<p>"content": "你是一名字幕清洗专家，请你对下面的 .srt 字幕内容进行处理：【清洗要求】： 1. 修改所有错别字，使语句通顺； 2. 删除或替换所有低俗语言、脏话； 3. 替换所有涉及违法、敏感、违禁的词句（包括政治敏感、涉黄涉暴等），改为中性表达或删除； 4. 保留时间轴格式（即每条字幕的时间线不变）； 5. 不添加解释或注释，只返回清洗后的字幕内容； 6. 如果某句无需修改，原样保留； 7. 输出必须是标准的 .srt 字幕格式（包括空行、时间、换行等等）。 下面是字幕原文"</p>
<p>},</p>
<p>{</p>
<p>"role": "user",</p>
<p>"content": {{ JSON.stringify($json["content"]) }}</p>
<p>}</p>
<p>]</p>
<p>}</p>

<p>这里的提示词可以根据自己的需求去微调，如果你觉得AI替换的不好，也可以让AI把违禁词换成*，后续通过剪映软件的查找功能快速定位自己替换。</p>
<p>{</p>
<p>"model": "qwen-turbo",</p>
<p>"messages": [</p>
<p>{</p>
<p>"role": "system",</p>
<p>"content": "你是一名字幕清洗专家，请你对下面的 .srt 字幕内容进行处理：【清洗要求】：将所有错别字的具体字替换为 *（不改正为正确字）；将所有低俗语言、脏话替换为 *；将所有涉及违法、敏感、违禁的词句（包括政治敏感、涉黄涉暴等）的相关部分替换为 *；保留时间轴格式（即每条字幕的时间线不变）；不添加解释或注释，只返回清洗后的字幕内容；如果某句无需修改，原样保留；输出必须是标准的 .srt 字幕格式（包括空行、时间、换行等）。下面是字幕原文"</p>
<p>},</p>
<p>{</p>
<p>"role": "user",</p>
<p>"content": {{ JSON.stringify($json["content"]) }}</p>
<p>}</p>
<p>]</p>
<p>}</p>

<p>特别提醒：修改content的时候注意，提示词千万不要换行，否则代码会报错！</p>

<p>完成上面的设置之后，我们就可以点击【Execute step】按钮，然后会给AI发请求，</p>
<p>等几秒就会返回优化好的数据。</p>
<p><img src="img/5da8420184597d1e5a7bc2fe537ce48b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/A4nCblAGAo598KxP1Pdc362lnSh/"/></p>
<p><img src="img/6a9ed4033d78e899a294b554b2d25c89.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ItinbDNxQoRu6nxNV0bckQ54nFh/"/></p>
<p>此时，就成功实现了字幕的优化，敏感词、违禁词、脏话等等，都被修改了。</p>
<p>如果对结果不满意还可以改提示词，慢慢调整和测试，总会合适的。</p>
<p>至此，恭喜你，就差一步一个完整的工作流就快好了。</p>
<h3>四、返回文本字幕文件并转成.srt文件。</h3>
<p>因为AI返回给我们的还是文本字幕，但是最终我们需要拖到剪影的可是.srt字幕文件，所以我们最后需要把文本字幕文件变成.srt字幕文件。</p>
<p>还是点左上角返回，我们第三个模块右边的加号，再添加一个【code】模块。</p>
<p><img src="img/ee670bd0c59e1687fd68eb3f86b326b0.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Rng8bIMD9oedybxrM6VcdIL6nkb/"/></p>
<p>这里我们要改两个地方，</p>
<p>一个是mode模型，不能用默认的，我们要改成 Run Once for Each ltem ，因为AI返回的数据是个数组，尽管它只包含一个字幕数据，但是还是要用 Run Once for Each ltem，这样就算多个字幕数据也能轻松处理。</p>
<p>第二个就是把文本字幕变成二进制.srt字幕文件的代码</p>
<p><img src="img/0cd7aa2015b9b6dae19e26519ae2363b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PKjybWOUtoc2eDxpzWAc3uoznS6/"/></p>
<p>代码：</p>
<p>const content = $json["choices"]?.[0]?.["message"]?.["content"];</p>
<p>if (!content || content.trim() === "") {</p>
<p>throw new Error("字幕内容为空，生成失败！");</p>
<p>}</p>
<p>function toBase64(str) {</p>
<p>return Buffer.from(str).toString('base64');</p>
<p>}</p>
<p>return {</p>
<p>binary: {</p>
<p>data: {</p>
<p>data: toBase64(content),</p>
<p>mimeType: 'application/x-subrip',</p>
<p>fileName: 'ai_output.srt',</p>
<p>}</p>
<p>}</p>
<p>};</p>
<p>完成上面的设置之后，我们就可以点击【Execute step】按钮。</p>
<p>很快，右边的OUTPUT输入板块就出现了一个二进制的字幕文件，我们点【download】按钮，就可以把AI优化修改的字幕文件下载咯。</p>
<p><img src="img/f6cb47e683c87ad626b182e37a4837e5.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/T0oPb6Kgyo1t6yxJp3KczS73nbh/"/></p>
<p>至此，工作流的所有流程，咱们就彻底搭建完毕了。</p>

<p>我们只需要把下载的字幕文件拖进剪映，就不用自己辛辛苦苦的再去一个字一个字排查咯</p>

<p>最后，如果这篇文章数据好的话，我可以搭建一个网站方便大家去使用这个工具，就不用麻烦的去搞工作流了。</p>

<p>如果想学好工作流一定要多动手，看百变都不如手动一遍。</p>

<p>也欢迎大家提出新的问题或者痛点，我看到了就会写一篇解决方案，帮助圈友成长。</p>




